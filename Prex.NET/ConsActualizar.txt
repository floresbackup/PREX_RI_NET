'Parametros sParam(0)=Cuadro|sParam(1)=Periodo|sParam(2)=CodCons|sParam(3)=Entidad|
'           sParam(4)=Columnas|sParam(5)=MesDesde|sParam(6)=MostrarSoloConSaldo|
'           sParam(7)=TablaDatos|sParam(8)=PrefijoTablaDatos
Public Function ConsActualizar(ByVal sParametros As String) As Boolean
   
   On Error GoTo Err_Trap:
   
   Dim sSQL          As String
   Dim dFechaVig     As Date
   Dim RS            As Recordset
   Dim nCont         As Long
   Dim sParam()      As String
   Dim sIndice       As String
   Dim sTabla        As String
   Dim nMaxNivel     As Long
   
   sParam = Split(sParametros, "|")
   sTabla = sParam(7)
   sIndice = sParam(8)
   
   sSQL = "SELECT  MAX(RU_FECVIG) AS MAX_FECHA " & _
          "FROM    RELCUE " & _
          "WHERE   RU_FECVIG <= " & FechaSQL(sParam(1))
   Set RS = oAdmLocal.AbrirRecordset(sSQL)
   
   If RS.BOF And RS.EOF Then
      MensajeInformacion "No existen relaciones con vigencia igual o anterior al período seleccionado. Por favor verifique el Mapa de Relaciones!"
      GoTo Err_Trap
   End If

   dFechaVig = RS!MAX_FECHA
   
   Set RS = Nothing

   nMaxNivel = ConsTotalizar(sParam(0), CDate(sParam(1)), dFechaVig, sParam(2), sParam(3), sParam(4), sParam(5), sTabla, sIndice)
   DoEvents
   
   sSQL = ""
      
   If CBool(Val(sParam(6))) Then
      
      For nCont = 0 To Val(sParam(4))
         sSQL = sSQL & sIndice & "_MES" & nCont & " + "
      Next
      
      sSQL = Left(sSQL, Len(sSQL) - 2)
      sSQL = "AND (" & sSQL & ") <> 0 "
   End If

   sSQL = "SELECT    * " & _
          "FROM      " & sTabla & " " & _
          "WHERE     " & sIndice & "_CUADRO = " & sParam(0) & " " & _
          "AND       " & sIndice & "_FECVIG = " & FechaSQL(sParam(1)) & " " & _
          "AND       " & sIndice & "_CODENT = " & sParam(3) & " " & _
          "AND       " & sIndice & "_CODCON = '" & sParam(2) & "' " & _
          "AND       " & sIndice & "_ACTIVA = 1 " & _
          IIf(CBool(Val(sParam(6))), "AND (" & sIndice & "_MES" & Val(sParam(4)) & " <> 0 OR " & sIndice & "_MES" & Val(sParam(4)) - 1 & " <> 0) ", " ") & _
          "ORDER BY  " & sIndice & "_ORDEN, " & sIndice & "_CODPAR, " & sIndice & "_CAMPO8 ASC"

   nMaxNivel = 17
   ConsFormatoCondicional nMaxNivel
   
   ConsActualizar = True

Err_Trap:
   Screen.MousePointer = 0
   Set RS = Nothing
   
   If Err.Number <> 0 Then
      TratarError "Actualizar"
   End If
 
End Function
